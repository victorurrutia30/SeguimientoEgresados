<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewBag.Title - Mi aplicación ASP.NET</title>

    @Styles.Render("~/Content/css")

    <!-- Iconos (SRI corregido). Si vuelve a fallar en dev, puedes quitar el atributo integrity. -->
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
          integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A=="
          crossorigin="anonymous" referrerpolicy="no-referrer" />

    @Scripts.Render("~/bundles/modernizr")

    <!-- Fallback mínimo para la navbar (por si el bundle de CSS está cacheado o falla) -->
    <style>
      .app-navbar { background:#5D0A28; color:#fff; box-shadow:0 2px 4px rgba(0,0,0,.08); }
      .app-navbar .nav-inner.container { display:flex; align-items:center; justify-content:space-between; gap:16px; padding:10px 16px; }
      .app-navbar .nav-menu { list-style:none; margin:0; padding:0; display:flex; gap:16px; }
      .app-navbar .nav-link { color:#fff !important; text-decoration:none; font-weight:500; padding:6px 8px; border-radius:4px; }
      .app-navbar .nav-link:hover { background:rgba(255,255,255,.1); }
      .brand-pill { display:inline-block; color:#fff !important; background:rgba(255,255,255,.08); padding:6px 12px; border-radius:999px; font-weight:600; text-decoration:none; }
      .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0;}
      @@media (max-width: 768px){
        .app-navbar .nav-inner.container{ flex-wrap:wrap; }
        .app-navbar .nav-menu{ display:none; width:100%; flex-direction:column; padding:8px 0; }
        .app-navbar .nav-menu.is-open{ display:flex; }
      }
    </style>
</head>
<body>
    @* SOLO mostrar navbar si está autenticado y la vista no la oculta *@
    @if (Request.IsAuthenticated && !(ViewBag.HideNavbar ?? false))
    {
        <nav class="app-navbar" role="navigation" aria-label="Barra principal">
            <div class="nav-inner container">
                <div class="nav-left">
                    @* Enlaza a DashboardController.Index *@
                    @Html.ActionLink("UTEC Egresados", "Index", "Dashboard", null, new { @class = "brand-pill" })

                    <button class="nav-toggle" type="button" aria-expanded="false" aria-controls="navMenu">
                        <span class="nav-toggle-bar"></span>
                        <span class="nav-toggle-bar"></span>
                        <span class="nav-toggle-bar"></span>
                        <span class="sr-only">Abrir menú</span>
                    </button>

                    <ul id="navMenu" class="nav-menu list-unstyled">
                        <li>@Html.ActionLink("Inicio", "Index", "Home", new { area = "" }, new { @class = "nav-link" })</li>
                        <li>@Html.ActionLink("Dashboard", "Index", "Dashboard", null, new { @class = "nav-link" })</li>
                        @* Agrega más enlaces reales cuando existan endpoints *@
                    </ul>
                </div>

                <div class="nav-right">
                    <span class="user-chip" title="@User.Identity.Name">
                        <i class="fa-regular fa-user"></i> @User.Identity.Name
                    </span>

                    @* Form de logout: POST + AntiForgery. La acción redirige a Home/Index *@
                    @using (Html.BeginForm("Logout", "Autenticacion", FormMethod.Post, new { id = "logoutForm", @class = "logout-form" }))
                    {
                        @Html.AntiForgeryToken()
                        <button type="submit" class="btn btn-ghost">
                            <i class="fa-solid fa-right-from-bracket"></i> Cerrar sesión
                        </button>
                    }
                </div>
            </div>
        </nav>
    }

    <div class="container body-content">
        @RenderBody()
        <hr />
        @* Mostrar el footer del layout solo si la vista NO lo oculta *@
        @if (ViewBag.HideLayoutFooter == null || ViewBag.HideLayoutFooter == false)
        {
            <footer>
                <p>&copy; @DateTime.Now.Year - Mi aplicación ASP.NET</p>
            </footer>
        }
    </div>

    @Scripts.Render("~/bundles/jquery")
    @Scripts.Render("~/bundles/bootstrap")

    <script>
        (function () {
            document.addEventListener('click', function (e) {
                var btn = e.target.closest('.nav-toggle');
                if (!btn) return;
                var menu = document.getElementById('navMenu');
                var expanded = btn.getAttribute('aria-expanded') === 'true';
                btn.setAttribute('aria-expanded', (!expanded).toString());
                if (menu) menu.classList.toggle('is-open', !expanded);
            });
        })();
    </script>

    @RenderSection("scripts", required: false)
</body>
</html>
